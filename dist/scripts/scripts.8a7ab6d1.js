"use strict";angular.module("customApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainController"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("customApp").controller("MainController",["$scope","DemoDataGenerator","$interval",function(a,b,c){function d(){delete f.data,f.data=b.get(a.itemsCount),a.$broadcast("grid:rebind",f)}function e(){var a=angular.element(document.getElementsByTagName("body")),b=[],c=function(a){angular.forEach(["$scope","$isolateScope"],function(c){a.data()&&a.data().hasOwnProperty(c)&&angular.forEach(a.data()[c].$$watchers,function(a){b.push(a)})}),angular.forEach(a.children(),function(a){c(angular.element(a))})};c(a);var d=[];return angular.forEach(b,function(a){d.indexOf(a)<0&&d.push(a)}),d.length}a.itemsCount=300;var f={pageSize:50,data:b.get(a.itemsCount),virtualization:!1,sortable:!0,filterable:!0,editable:!0};a.options=f,a.applySettings=d,c(function(){a.watchersCount=e()},1e3)}]),angular.module("customApp").controller("AboutCtrl",["$scope",function(a){}]),angular.module("customApp").directive("customGrid",function(){return{templateUrl:"views/customGridTemplate.html",restrict:"EA",controller:"CustomGridController",scope:!0,compile:function(a){a.html();return function(a,b,c){var d=a.options;a.element=b,a.initGrid(d,b)}}}}),angular.module("customApp").directive("customSpinner",["$timeout",function(a){return{priority:600,controller:["$scope","$element",function(b,c){var d='<div class="loading-bar-spinner"><div class="spinner-icon"></div></div>',e=angular.element(d),f=0;b.spinnerStart=function(){f++,c.append(e)},b.spinnerStop=function(){f--,0===f&&e.detach()},b.withSpinner=function(c){return function(){b.spinnerStart();try{c.apply(null,arguments)}finally{a(b.spinnerStop,2e3)}}}}]}}]),angular.module("customApp").factory("CustomGrid",["DefaultOptions",function(a){var b=function(a){var b=this,c=function(){return b._data.length},d=function(){return b._pristineData.length},e=function(){for(var a=[],c=b.total(),d=b._options.pageSize,e=Math.ceil(c/d),f=0;e>f;f++)a.push({from:f*d,to:(f+1)*d,data:_.slice(b._data,f*d,(f+1)*d)});return a},f=function(){return b._ranges.length},g=function(a,c){c===!0&&(b.view.length=0),_.isUndefined(a)&&(a=b.page());var d=b._ranges[a-1];d&&d.from>=b.view.length&&Array.prototype.push.apply(b.view,d.data)},h=function(a){b.view.length=0,_.each(a,function(a){g(a)})},i=function(a){if(!a)return b._page;if(a>f())throw"Page range error. You try set "+a+" page of "+f();g(a,!b.virtualization),b._page=a},j=function(a,c){var d=function(b,c,d){var e;return e=b[a]===c[a]?0:b[a]>c[a]?1:-1,"asc"===d?e:-1*e};b._data.sort(_.partialRight(d,c)),b._ranges=e(),b.virtualization?h(_.range(1,b.page()+1)):g(void 0,!0),b.sorting.direction=c,b.sorting.column=a},k=function(){var a=_.filter(b._pristineData,function(a){var c=!0;if(_.each(b.filters,function(b,d){"__selected"===d?c=c&&a[d]===!0:b&&-1===a[d].indexOf(b)&&(c=!1)}),c&&b.filters.Age){var d=b.filters.Age.split("-");c=a.Age>d[0]&&a.Age<d[1]}return c});b._data.length=0,Array.prototype.push.apply(b._data,a),b._ranges=e(),b._page=1,b.view.length=0,b.fetchPage()},l=function(a){b._options.editable&&(_.contains(b.selected,a)?(_.pull(b.selected,a),delete a.__selected):(b.selected.push(a),a.__selected=!0))},m=function(){_.each(b.selected,function(a){delete a.__selected}),b.selected.length=0,b.filters.__selected&&b.filter()},n=function(){_.each(b.selected,function(a){_.pull(b._pristineData,a)}),b._data.length=0,Array.prototype.push.apply(b._data,b._pristineData),b._ranges=e(),b.virtualization?h(_.range(1,b.page()+1)):g(void 0,!0),b.selected.length=0,b._total=b.total(),b._pristineTotal=b.pristineTotal(),b.filters.__selected&&b.filter()},o=function(a){b.filters[a]="",b.filter()};b.totalPages=f,b.total=c,b.getRanges=e,b.pristineTotal=d,b.clearFilter=o,b.clearSelection=m,b.remove=n,b.select=l,b.filter=k,b.sort=j,b.page=i,b.fetchPage=g,b.fetchPages=h,b.init(a)};return b.prototype.init=function(b){var c=this,d=function(b){var c={};return _.extend(c,angular.copy(a)),_.each(b,function(c,d){a.hasOwnProperty(d)||delete b[d]}),_.extend(c,angular.copy(b)),c},e=function(a){return a.length?_.chain(a).first().keys().without("__uid","__selected","__editing").value():[]},f=function(a){_.each(a,function(a,b){_.each(["__uid","__selected","__editing"],function(b){if(a.hasOwnProperty(b))throw"dataItems should not contain "+b+" property"}),a.__uid=b})};if(c._options=d(b),c._pristineData=c._options.data,c._data=c._pristineData.slice(),c._ranges=c.getRanges(),c._total=c.total(),c._pristineTotal=c.pristineTotal(),c._pageSize=c._options.pageSize,c._page=1,c.selected=[],c.filters={},c.sorting={column:"__uid",direction:"asc"},c.paging={pageSize:c._pageSize},c.view=[],c.virtualization=c._options.virtualization,c.columns=e(c._pristineData),c.columns.length||(c.columns=c._options.columns||[]),!c.columns.length)throw"You must specified dataItems or columns!";f(c._pristineData),c.fetchPage(1)},b}]),angular.module("customApp").controller("CustomGridController",["$scope","CustomGrid","$modal",function(a,b,c){function d(c){a.grid=m=new b(c),a.element.data("custom-grid",m),a.$broadcast("grid:init",m),a.sort=a.withSpinner(g),a.filter=a.withSpinner(f),a.page=a.withSpinner(e)}function e(a){m.page(a)}function f(){m.filter()}function g(a){if(m._options.sortable){var b;b=m.sorting.column===a&&"asc"===m.sorting.direction?"desc":"asc",m.sort(a,b)}}function h(){_.isUndefined(m.filters.__selected)?m.filters.__selected=!0:delete m.filters.__selected,a.filter()}function i(b,d){d.stopPropagation();var e={templateUrl:"views/editModal.html",scope:a,controller:"EditModalController",size:"sm",resolve:{dataItem:function(){return b}}};c.open(e)}function j(a,b){b.stopPropagation(),a.__editing={},_.each(m.columns,function(b){a.__editing[b]=a[b]})}function k(a,b){b.stopPropagation(),delete a.__editing}function l(a,b){b.stopPropagation(),_.each(m.columns,function(b){a[b]=a.__editing[b]}),delete a.__editing}var m;a.initGrid=a.withSpinner(d),a.$on("grid:rebind",function(b,c){a.initGrid(c)}),a.editModal=i,a.editInline=j,a.rejectInlineChanges=k,a.saveInlineChanges=l,a.filterBySelection=h}]),angular.module("customApp").controller("AgeColumnFilterController",["$scope",function(a){a.ages=[{name:"10-20",value:"10-20"},{name:"20-30",value:"20-30"},{name:"30-40",value:"30-40"}],a.selected=a.ages[0].value,a.$watch("selected",function(b){a.grid.filters.Age=b})}]),angular.module("customApp").controller("PagingController",["$scope","$rootScope",function(a,b){var c;a.$on("grid:init",function(b,d){c=d,a.currentPage=c.page()}),b.$on("scroll:change",function(a,b){var d=(c.view.length*b/100).toFixed(0),e=Math.floor(d/c.paging.pageSize)+1;e!==c._page&&e<=c.totalPages()&&c.page(e)}),b.$on("scroll:bottom",function(a){c.fetchPage()})}]),angular.module("customApp").controller("EditModalController",["$scope","dataItem",function(a,b){function c(){_.each(a.columns,function(c){b[c]=a.dataItem[c]}),b.Age=parseInt(b.Age,10),a.$close()}function d(a){return _.chain(a).keys().without("__uid","__selected").value()}a.dataItem=angular.copy(b),a.columns=d(b),a.saveChanges=c}]),angular.module("customApp").service("DemoDataGenerator",function(){var a=function(a){var b=[];return _.times(a,function(){var a="Name-"+_.random(0,100,!1),c="Surname-"+_.random(0,100,!1);b.push({Id:_.random(1e5,1e7-1,!1).toString(),FirstName:a,LastName:c,Age:_.random(18,60,!1),Email:a+"@gmail.com"})}),b};return{get:a}}),angular.module("customApp").directive("customScroll",["$rootScope",function(a){return{restrict:"EA",scope:{silent:"="},link:function(b,c,d){c.bind("scroll",function(){var d=b.silent;if(!d){var e=100*this.scrollTop/(this.scrollHeight-this.clientHeight);e=e.toFixed(0),a.$emit("scroll:change",e);var f=$(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight;f&&a.$emit("scroll:bottom"),c.scope().$apply()}})}}}]),angular.module("customApp").constant("DefaultOptions",{pageSize:10,virtualization:!1,sortable:!0,filterable:!0,editable:!0,data:[{Id:"1",FirstName:"FirstName",LastName:"LastName",Age:12,Email:"Email"}]});