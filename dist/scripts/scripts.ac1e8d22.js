"use strict";angular.module("customApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","custom-grid"]),angular.module("custom-scroll",[]).directive("customScroll",["$rootScope",function(a){return{restrict:"EA",scope:{silent:"="},link:function(b,c,d){c.bind("scroll",function(){var d=b.silent;if(!d){var e=100*this.scrollTop/(this.scrollHeight-this.clientHeight);e=e.toFixed(0),a.$emit("scroll:change",e);var f=$(this).scrollTop()+$(this).innerHeight()>=this.scrollHeight;f&&a.$emit("scroll:bottom"),c.scope().$apply()}})}}}]),angular.module("custom-spinner",[]).directive("customSpinner",["$timeout",function(a){return{priority:600,controller:["$scope","$element",function(b,c){var d='<div class="loading-bar-spinner"><div class="spinner-icon"></div></div>',e=angular.element(d),f=0;b.spinnerStart=function(){f++,c.append(e)},b.spinnerStop=function(){f--,0===f&&e.detach()},b.withSpinner=function(c){return function(){b.spinnerStart();try{c.apply(null,arguments)}finally{a(b.spinnerStop,2e3)}}}}]}}]),angular.module("customApp").config(["$routeProvider","customGridProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainController"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"}),b.defaults.filterable=!0}]),angular.module("customApp").service("DemoDataGenerator",function(){var a=function(a){var b=["gmail.com","mail.ru","ukr.net","yandex.ru","rambler.ru"],c=[];return _.times(a,function(){var a="Name-"+_.random(0,100,!1),d="Surname-"+_.random(0,100,!1);c.push({Id:_.random(1e5,1e7-1,!1).toString(),FirstName:a,LastName:d,Age:_.random(18,60,!1),Email:a+"@"+b[_.random(0,b.length-1,!1)]})}),c};return{get:a}}),angular.module("customApp").controller("MainController",["$scope","DemoDataGenerator","$interval",function(a,b,c){function d(){delete f.data,f.data=b.get(a.itemsCount),a.$broadcast("grid:rebind",f)}function e(){var a=angular.element(document.getElementsByTagName("body")),b=[],c=function(a){angular.forEach(["$scope","$isolateScope"],function(c){a.data()&&a.data().hasOwnProperty(c)&&angular.forEach(a.data()[c].$$watchers,function(a){b.push(a)})}),angular.forEach(a.children(),function(a){c(angular.element(a))})};c(a);var d=[];return angular.forEach(b,function(a){d.indexOf(a)<0&&d.push(a)}),d.length}a.itemsCount=300;var f={pageSize:50,data:b.get(a.itemsCount),virtualization:!1,sortable:!0,filterable:!0,editable:!0};a.options=f,a.applySettings=d,c(function(){a.watchersCount=e()},1e3)}]),angular.module("customApp").controller("AboutCtrl",["$scope",function(a){}]),angular.module("custom-grid",["custom-spinner","custom-scroll","ui.bootstrap"]),angular.module("custom-grid").provider("customGrid",function(){var a=this.defaults={pageSize:10,virtualization:!1,sortable:!0,filterable:!0,editable:!0,data:[{Id:"1",FirstName:"FirstName",LastName:"LastName",Age:12,Email:"Email"}]};this.$get=function(){var b=function(b){var c=this,d=function(){return c._data.length},e=function(){return c._pristineData.length},f=function(){for(var a=[],b=c.total(),d=c._options.pageSize,e=Math.ceil(b/d),f=0;e>f;f++)a.push({from:f*d,to:(f+1)*d,data:_.slice(c._data,f*d,(f+1)*d)});return a},g=function(){return c._ranges.length},h=function(a,b){b===!0&&(c.view.length=0),_.isUndefined(a)&&(a=c.page());var d=c._ranges[a-1];d&&d.from>=c.view.length&&Array.prototype.push.apply(c.view,d.data)},i=function(a){c.view.length=0,_.each(a,function(a){h(a)})},j=function(a){if(!a)return c._page;if(a>g())throw"Page range error. You try set "+a+" page of "+g();h(a,!c.virtualization),c._page=a},k=function(a,b){var d=function(b,c,d){var e;return e=b[a]===c[a]?0:b[a]>c[a]?1:-1,"asc"===d?e:-1*e};c._data.sort(_.partialRight(d,b)),c._ranges=f(),c.virtualization?i(_.range(1,c.page()+1)):h(void 0,!0),c.sorting.direction=b,c.sorting.column=a},l=function(){var a=_.filter(c._pristineData,function(a){var b=!0;if(_.each(c.filters,function(c,d){if("__selected"===d)b=b&&a[d]===!0;else if("Age"===d){var e=_.last(c.split("-")),f=_.first(c.split("-"));b=b&&a[d]>f&&a[d]<e}else c&&-1===a[d].indexOf(c)&&(b=!1)}),b&&c.filters.Age){var d=c.filters.Age.split("-");b=a.Age>d[0]&&a.Age<d[1]}return b});c._data.length=0,Array.prototype.push.apply(c._data,a),c._ranges=f(),c._page=1,c.view.length=0,c.fetchPage()},m=function(a){c._options.editable&&(_.contains(c.selected,a)?(_.pull(c.selected,a),delete a.__selected):(c.selected.push(a),a.__selected=!0))},n=function(){_.each(c.view,function(a){a.__selected||c.select(a)})},o=function(){_.each(c.selected,function(a){delete a.__selected}),c.selected.length=0,c.filters.__selected&&c.filter()},p=function(){_.each(c.selected,function(a){_.pull(c._pristineData,a)}),c._data.length=0,Array.prototype.push.apply(c._data,c._pristineData),c._ranges=f(),c.virtualization?i(_.range(1,c.page()+1)):h(void 0,!0),c.selected.length=0,c._total=c.total(),c._pristineTotal=c.pristineTotal(),c.filter()},q=function(a){c.filters[a]="",c.filter()},r=function(b){var c=this,d=function(a){return a.length?_.chain(a).first().keys().without("__uid","__selected","__editing").value():[]},e=function(a){_.each(a,function(a,b){_.each(["__uid","__selected","__editing"],function(b){if(a.hasOwnProperty(b))throw"dataItems should not contain "+b+" property"}),a.__uid=b})};if(c._options=angular.extend({},a,b),c._pristineData=c._options.data,c._data=c._pristineData.slice(),c._ranges=c.getRanges(),c._total=c.total(),c._pristineTotal=c.pristineTotal(),c._pageSize=c._options.pageSize,c._page=1,c.selected=[],c.filters={},c.sorting={column:"__uid",direction:"asc"},c.paging={pageSize:c._pageSize},c.view=[],c.virtualization=c._options.virtualization,c.columns=d(c._pristineData),c.columns.length||(c.columns=c._options.columns||[]),!c.columns.length)throw"You must specified dataItems or columns!";e(c._pristineData),c.fetchPage(1)};c.totalPages=g,c.total=d,c.getRanges=f,c.pristineTotal=e,c.clearFilter=q,c.clearSelection=o,c.remove=p,c.select=m,c.filter=l,c.sort=k,c.page=j,c.fetchPage=h,c.selectAll=n,c.init=r,c.init(b)};return b}}),angular.module("custom-grid").controller("AgeColumnFilterController",["$scope",function(a){a.ages=[{name:"10-20",value:"10-20"},{name:"20-30",value:"20-30"},{name:"30-40",value:"30-40"},{name:"40+",value:"40-9999"}]}]),angular.module("custom-grid").controller("PagingController",["$scope","$rootScope",function(a,b){var c;a.$on("grid:init",function(b,d){c=d,a.currentPage=c.page()}),b.$on("scroll:change",function(a,b){var d=(c.view.length*b/100).toFixed(0),e=Math.floor(d/c.paging.pageSize)+1;e!==c._page&&e<=c.totalPages()&&c.page(e)}),b.$on("scroll:bottom",function(a){c.fetchPage()})}]),angular.module("custom-grid").controller("EditModalController",["$scope","dataItem",function(a,b){function c(){_.each(a.columns,function(c){b[c]=a.dataItem[c]}),b.Age=parseInt(b.Age,10),a.$close()}function d(a){return _.chain(a).keys().without("__uid","__selected").value()}a.dataItem=angular.copy(b),a.columns=d(b),a.saveChanges=c}]),angular.module("custom-grid").controller("CustomGridController",["$scope","customGrid","$modal",function(a,b,c){function d(c){a.grid=n=new b(c),a.element.data("custom-grid",n),a.$broadcast("grid:init",n),a.sort=a.withSpinner(h),a.filter=a.withSpinner(g),a.page=a.withSpinner(f),a.remove=a.withSpinner(e)}function e(){n.remove()}function f(a){n.page(a)}function g(){n.filter()}function h(a,b){if(!n._options.sortable)return void b.stopPropagation();var c;c=n.sorting.column===a&&"asc"===n.sorting.direction?"desc":"asc",n.sort(a,c)}function i(){_.isUndefined(n.filters.__selected)?n.filters.__selected=!0:delete n.filters.__selected,a.filter()}function j(b,d){d.stopPropagation();var e={templateUrl:"scripts/custom/custom-grid/views/editModalTemplate.html",scope:a,controller:"EditModalController",size:"sm",resolve:{dataItem:function(){return b}}};c.open(e)}function k(a,b){b.stopPropagation(),a.__editing={},_.each(n.columns,function(b){a.__editing[b]=a[b]})}function l(a,b){b.stopPropagation(),delete a.__editing}function m(a,b){b.stopPropagation(),_.each(n.columns,function(b){a[b]=a.__editing[b]}),delete a.__editing}var n;a.initGrid=a.withSpinner(d),a.$on("grid:rebind",function(b,c){a.initGrid(c)}),a.editModal=j,a.editInline=k,a.rejectInlineChanges=l,a.saveInlineChanges=m,a.filterBySelection=i}]),angular.module("custom-grid").directive("customGrid",function(){return{templateUrl:"scripts/custom/custom-grid/views/customGridTemplate.html",restrict:"EA",controller:"CustomGridController",scope:!0,compile:function(a){a.html();return function(a,b,c){var d=a.options;a.element=b,a.initGrid(d,b)}}}});